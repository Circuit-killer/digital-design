# Tools Installation Instructions

This document describes how to install the software that will be used in this tutorial.

## Prerequisites

* **For students with Papilio hardware:** A computer running 32-bit Ubuntu (i386) physically or in virtualization (via VirtualBox, Parallels, etc). Windows should also work, but instructions are targeted at Linux. MacOS cannot be used natively because Xilinx does not provide tooling for the Mac; macOS users are recommended to run Ubuntu in [Parallels Desktop Lite](https://itunes.apple.com/au/app/parallels-desktop-lite/id1085114709?mt=12), free.

* **For students without hardware:** A computer running Linux, macOS or Windows.

All of the design entry and simulation tools will run on Windows, Linux, and Mac OS, but Ubuntu or Windows is required when working with the Papilio/Xilinx hardware.

This tutorial is aimed at 32-bit Ubuntu Linux users (specifically `i386 Ubuntu 16.10 Desktop`). Other 32-bit versions of Linux should work equally well. Ubuntu can be virtualized on Mac OS X or Windows through use of VirtualBox or other tools. I have had issues getting the Papilio software to run correctly on 64-bit versions of Ubuntu. **If you plan on using the Papilio hardware and toolset, I recommend using an i386 version of Ubuntu Desktop such as [this one](http://mirror.pnl.gov/releases/16.10/ubuntu-16.10-desktop-i386.iso).**

## What to Install?

If you have a Papilio development board, install everything described in this document:

* [Icarus Verilog](#icarus-verilog)
* [GTKWave](#gtkwave)
* [Yosys](#yosys-open-synthesis-suite)
* [Xilinx ISE WebPack](#xilinx-ise-webpack)
* [Papilio Loader](#papilio-loader)

If you do not have a Papilio board (and are interested only in simulating designs), then install:

* [Icarus Verilog](#icarus-verilog)
* [GTKWave](#gtkwave)
* [Yosys](#yosys-open-synthesis-suite)

# Software

### Icarus Verilog

**_What's it do?_** Simulates hardware designs written in the Verilog language.
**_Who needs it?_** Individuals interested in designing and simulating digital circuits in Verilog.

On Ubuntu
```
$ apt update             
$ apt install verilog
```

On Mac OS X
```
$ brew install icarus-verilog
```

### GTKWave

**_What's it do?_** Provides a GUI to view waveform output generated by Icarus Verilog and a variety of other industry standard circuit simulators.
**_Who needs it?_** Individuals interested in designing and simulating digital circuits in Verilog.

On Ubuntu:
```
$ apt install gtkwave
```

On Mac OS X:
```
$ brew install gtkwave
```

**macOS Users:** I've found the build of GTKWave generated by Homebrew to be usable but less stable than the pre-packaged builds available on the web. If Homebrew fails you, [try one such as this]([http://mac.softpedia.com/get/Utilities/gtkwave.shtml#download).

### Yosys Open Synthesis Suite

**_What's it do?_** Synthesizes Verilog hardware designs from _RTL_ into a gate-level netlist (for demonstration only; Xilinx EDA tools will be utilized to synthesize our design for the Papilio board.)
**_Who needs it?_** Individuals interested in experimenting with the process of synthesizing Verilog into gate-level netlists.

On Ubuntu:
```
$ sudo apt install yosys
```

On Mac OS X:
```
$ brew tap bsmt/homebrew-tap
$ brew install yosys
```

### Xilinx ISE WebPack

**_What's it do?_** Synthesizes Verilog into a format that can be loaded onto the Papilio's Spartan FPGA.
**_Who needs it?_** Individuals interested in programming Xilinx FPGAs with integrated circuit designs. Useful only if targeting these examples at the Papilio FPGA board. Not required for those without a Papilio or other Xilinx-based development board.

Note that ISE was EOL'd in 2013 and is no longer supported. It is nonetheless required for designs targeting the older Spartan-family of FPGAs found on the Papilio hardware.

Xilinx makes WebPack available at no cost but the installation process is a hassle. Xilinx requires you to register on their website before downloading the software and then generate and install a license file before using it. Plus, on Linux, you'll need to tweak the installation to prevent library conflicts with modern distributions (a side effect of the software's age and lack of support).

_Xilinx does not offer a macOS version of the software._

#### 1. Download

Download the most recent version (14.7) of the ISE Design tools (full product installation, _all 6 GBs_ of it) from Xilinx's site. [For Linux, here](https://survey.xilinx.com/ss/wsb.dll/Xilinx/ISE_Download_Survey.htm?wsb5=14.7&wsb6=1&wsb7=Xilinx_ISE_DS_Lin_14.7_1015_1.tar) and [for Windows, here](https://survey.xilinx.com/ss/wsb.dll/Xilinx/ISE_Download_Survey.htm?wsb5=14.7&wsb6=1&wsb7=Xilinx_ISE_DS_Win_14.7_1015_1.tar). Note that you will have to fill out a survey and accept EULA terms to download.

#### 2. Install

Windows users can execute the installer tool; Linux users should follow the instructions below:

  1. Un-tar the download; `cd` into Xilinx directory; run `xsetup` as superuser.
  2. When prompted for which suite of tools to install, choose **ISE WebPack** (note that this is not the default selection)
  3. Allow tools to be installed into the (default) `/opt/Xilinx` directory.

#### 3. Fix the libraries (Linux)

Disable obsolete versions of the C standard library to prevent issues with other tools (this will be required to get a license in the next section):

```
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so.6 /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so.6.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so.6.0.8 /opt/Xilinx/14.7/ISE_DS/common/lib/lin/libstdc++.so.6.0.8.disable

# These can be ignored on Fedora
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so.6 /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so.6.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so.6.0.8 /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin/libstdc++.so.6.0.8.disable
```

#### 4. Fire it up

As noted in the installation wizard, you must source a shell script (to configure your path, environmental variables and whatnot) prior to running ISE WebPack.

For Ubuntu users, this is as simple as:

```
$ source /opt/Xilinx/14.7/ISE_DS/settings32.sh
```

Then, fire-up the Design Suite software:

```
$ ise
```

Do not run ISE as superuser (various functions will not work).

I find it convenient to source `settings32.sh` from my login script (i.e., `~/.bashrc`). Various Makefiles and instructions found in these tutorials assume that this script has been sourced prior to executing any Xilinx-related instructions.

#### 5. Get a license

The first time you run ISE you'll be prompted to install a feature license. Follow the prompts to open the Xilinx License Configuration Manager (or choose "Manage License..." from the ISE "Help" menu) and follow these instructions:

1. Click the "Acquire a License" tab
2. Select the "Get free Vivado/ISE WebPack License" radio button
3. Click "Next"
4. A dialog will appear showing local system information; click "Connect Now".
5. Firefox should open a Xilinx licensing page. If Firefox does not launch (and the "Connect Now" button seems to have no effect but dismissing the dialog), check the console output in the terminal you used to launch the software. More likely than not, you still have a library conflict preventing Firefox from opening. Revisit the _Fix the Libraries_ step above.
6. Complete the Xilinx license questionnaire.
7. The license file should be emailed to you; when you receive it, return to the Xilinx License Configuration Manager, click the "Manage Licenses" tab; click the "Load License..." button and navigate to the `.lic` file you received in email. Voila! You're ready to go!

### Papilio Loader

**_What's it do?_** Loads the Xilinx-synthesized designs (created using ISE WebPack) onto the Papilio board.
**_Who needs it?_** Individuals with a Papilio development board. Not useful to those without Papilio hardware.

The Papilio loader replaces standard JTAG device programming tools (providing a less expensive, more user-friendly approach to FPGA development). The most reliable way to install this software on Linux is to clone its Git repository and run the installer script.

The Papilio Loader requires Java and a USB device driver to operate, plus we'll be using Git to fetch it. Install these dependent packages first:

```
$ sudo apt update
$ sudo apt install default-jdk libftdi-dev git
```

Then, from within your home directory (or other convenient location), use Git to fetch the Papilio Loader source code:

```
$ cd ~
$ git clone https://github.com/GadgetFactory/Papilio-Loader.git
```

Run the Linux installer script (located in the source directory we just cloned):

```
$ cd Papilio-Loader/
$ ./linux-installer.sh
```

The installer script will load various application components in the `/opt/GadgetFactory/` directory and place links to the `papilio-loader-gui` and `papilio-prog` in `/usr/local/bin/`
