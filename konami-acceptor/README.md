# Konami Acceptor

A state machine that accepts a user-entered Konami code (that is, pressing up, up, down, down, left, right, left right on the LogicStart's d-pad). Displays state changes and sequence acceptance on the four digit seven-segment display.

For those either too old or too young to remember, this key sequence was used as [a cheat code](https://en.wikipedia.org/wiki/Konami_Code) in Konami's 1987 video game, [Contra](https://en.wikipedia.org/wiki/Contra_(video_game)) (for the Nintendo Entertainment System); when a user keyed a similar sequence at startup, they'd be awarded 40 lives.

This circuit implements a four-bit state register and an edge detector on the d-pad inputs.

The edge detector works by sampling the d-pad inputs into a two-bit shift register on every rising clock edge. That is, at each clock cycle the current pressed/released state of each direction is placed into the least-significant bit of a two bit register and the previous least-significant bit is moved into the most-significant bit position. With this, we can detect a "key up" event by watching for the shift register to reach the value `2'b10`.

State     | Value    | Seven-Segment Display | Description
----------|----------|-----------------------|------------
`START`   | `4'd0`   | `----`                | Initial state; transitions to `UP_1` upon release of the up key.
`UP_1`    | `4'd1`   | `UP-1`                | Transitions to `UP_2` upon release of the up key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`UP_2`    | `4'd2`   | `UP-2`                | Transitions to `DOWN_1` upon release of the down key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`DOWN_1`  | `4'd3`   | `Dn-1`                | Transitions to `DOWN_2` upon release of the down key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`DOWN_2`  | `4'd4`   | `Dn-2`                | Transitions to `LEFT_1` upon release of the left key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`LEFT_1`  | `4'd5`   | `LF-1`                | Transitions to `RIGHT_1` upon release of the right key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`RIGHT_1` | `4'd6`   | `rh-1`                | Transitions to `LEFT_2` upon release of the left key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`LEFT_2`  | `4'd7`   | `LF-2`                | Transitions to `ACCEPT` upon release of the right key; transitions to `REJECT` after a 1 second timeout or in the presence of any other input
`ACCEPT`  | `4'd9`   | `9999`                | Transitions to `START` upon release of any key
`REJECT`  | `4'd10`  | `0000`                | Transitions to `START` upon release of any key

## Makefile

Target       | Description
-------------|------------
`compile`    | Compiles Verilog RTL into an internal format optimized for simulation by Icarus Verilog; generated objects are written to the `/gen` directory. Invoked implicitly when using the `simulate` target.
`simulate`   | Executes the Verilog simulation producing a VCD waveform as output: `waveform.vcd`.
`synthesize` | Translates the design into a Verilog netlist (a wiring of logic gates and flip-flops with all high-level Verilog language constructs removed). <br><br> For demonstration purposes only; Xilinx tools must be used to synthesize the design for use on the Papilio's FPGA.
`fpga`       | Copies the Xilinx-generated `.bit` file onto the Papilio Pro's FPGA. Requires superuser permissions and assumes the Papilio Pro is connected via USB. Note that this file must be generated using the Xilinx `ise` tool and placed into the `papilio/` directory; it cannot be generated by this makefile.
`clean`      | Removes generated files produced by the `compile`, `simulate` and `synthesize` targets.

## Design files in this project

File | Description
-----|------------
[`rtl/konami-acceptor.v`](rtl/konami-acceptor.v) | Top-level circuit module; implements a state machine that accepts a Konami code input. Instantiates a display character coder and display driver circuit.
[`rtl/konami-coder.v`](rtl/konami-coder.v) | Converts a state id into the set of segments that should be lit on each seven segment display.
[`rtl/display-driver.v`](rtl/display-driver.v) | Circuit that accepts four seven-input segment signals and multiplexes them onto the hardware's single segment/enable bus (driving each character for a fraction of a second).
[`test/testbench.vt`](test/testbench.vt) | Circuit test bench.
[`papilio/papilio-pro.ucf`](papilio/papilio-pro.ucf) | User constraints file providing a mapping of logical ports (defined in Verilog) to physical pins on the FPGA.
